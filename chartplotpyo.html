    <head> 
        <script src="v_modules/plotly-2.1.0.min.js"></script>
        <script src="v_modules/pyodide.js"></script>
        <style>
            body {
            font-family: system-ui;
            background: #0d0523;
            color: white;
            text-align: center;
            }

            .button {
            background-color: #0f042a; /* Green */
            border: 1px solid white;
            color: white;
            padding: 15px 32px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            }

            .button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            }

            .button:active {
            opacity: 0.6;
            }

            .plotly {
            width: 100%;
            height: 350px;
            overflow-y: scroll;
            }

        </style>
    </head>
    <body>
        <h1> Plotly / Pyodide </h1>
        
        <div style="width:4%;float:left"><br></div>
        
        <div style="width:45%;float:left">        
            <textarea style="width:100%;height:350px" id="plot-source">            
import plotly.express as px
xs = range(-30, 30)
ys = list(map(lambda x: x**3, xs))
fig = px.scatter(x=xs, y=ys)
fig.update_layout( margin={'l':10, 'r':20, 'b':10, 't':20,'pad':0} )

            </textarea>
            <br>
            <button id="generate-plot" class="button", onclick="window.pyodide.runPython('make_plot()')" disabled=true>Generate Plot</button>
            <br><br>
        </div>
        
        <div style="width:6%;float:left"><br></div>
        <div style="width:45%;float:left">
        <h3> Out Plot </h3>
        <div id="plotly-output">...loading pyodide...</div>
        </div>
        
        <div style="width:4%;float:left"><br></div>

        <script>

            function render_plot(container, plot_html) {
            var range = document.createRange();
            range.selectNode(container);
            var documentFragment = range.createContextualFragment(plot_html);
            while (container.hasChildNodes()) {  
                container.removeChild(container.firstChild);
            }
            container.appendChild(documentFragment);
            container.className = "plotly";
            };

            async function main() {
            let pyodide = await loadPyodide({ indexURL : 'https://cdn.jsdelivr.net/pyodide/v0.25.0/full/' });
            await pyodide.loadPackage(['pandas', 'micropip']);
            window.pyodide = pyodide;
            await pyodide.runPythonAsync(`
import micropip
import js

# get relevant html elements
plot_source = js.document.getElementById('plot-source')
plot_button = js.document.getElementById('generate-plot')
plot_output = js.document.getElementById('plotly-output')

plot_output.innerHTML = '...loading plotly...'

# install plotly from pypi
await micropip.install('plotly==5.0.0')
plot_output.innerHTML = 'Ready to plot!'


def make_plot():
    plot_output.innerHTML = '...generating plot...'
    # run custom plotly code, defining 'fig'
    exec(plot_source.value, globals())
    # render figure as html, and display on page
    fig_html = fig.to_html(
        include_plotlyjs=False,
        full_html=False,
        default_height='350px'
    )
    js.render_plot(plot_output, fig_html)


# Generate graph using default code
make_plot()

# Enable custom plotting code
plot_button.disabled = False
plot_source.disabled = False
            `);
            };

            main();




        </script>
        
    </body>
