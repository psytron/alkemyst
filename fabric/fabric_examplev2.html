<!DOCTYPE html>
<html lang="en">
    <head>
		<title>Fabric Example</title>
		<base href="" target="_blank">
        <meta charset="utf-8">
        <style>body{background-color:#111133;color:white;}</style>
    </head>

    <body> 
		<div>SRVX FABRIC RUNNER</div>
        <script type="module">
			
			import KeyCache from '/keycache/keycache.js';
			import fabric from './fabric.js';
			import * as util from './drivers/util.js'
			import { OriginMatrix } from '../frame/originmatrix.js'


			fabric.addEventListener( 'fabricEvent' , async function( e ){
				var data=e.detail;
				console.log('onFabricEvent: ',e.detail.method , '  UUID:', e.detail.uuid , '  payload:', e.detail.payload )
				console.log('|')					
				var i=0;

				if( data.method =='login'){					
					fabric.mergeIntent( { uuid:'0x0x0x',module:'generic',method:'status' } ); 		
				}

				if( data.method =='status'){
					var aiObj = {
						"id":"5",
						"type":"Person",
						"name":"John Smith",
						"field":"Pharmacology",
						"contribution":"Research on drug-plant interactions",
						"label":"tag",
						"uuid":"oai_JohnSmith_oid",
						"level":2,
						"fn":"detailEvent",
						"ctx":{"nodes":[],"links":[]}
					}
					
		            var fabObj = {};
		            fabObj.module='generic';
		            fabObj.method ='report';
					fabObj.uuid='0x0x0x'
		            fabObj.params = aiObj;
		            fabric.mergeIntent( fabObj );
					
				}

		
				
			}); // fabricEvent
							
			
			window.addEventListener( 'load' , async function(){
				
				// SIGNING CREDENTIALS PROVIDER
				var creds = new KeyCache();
				var k = await creds.loginAndLoad( 'x' , 'x');				
				var ncr = creds.get('neo')	
				var matrix = new OriginMatrix({});
				
				var reqObj1 = {
					uuid:'0x0x0x', 
					module:'generic',
					method:'login',
					payload:{ un:'x@x.com', pw:'x' }
				}
				fabric.mergeIntent( reqObj1 ); 		


				
			});
		</script>













		
		
		<!-- Generated by the server -->
		<script id="datax" type="application/json">{"userId":1234,"userName":"John Doe","memberSince":"2000-01-01T00:00:00.000Z"}
		</script>
		<!-- Static -->
		<script>
		  const userInfo = JSON.parse( document.getElementById("datax").text );
		</script>

	</body>
	
</html>

