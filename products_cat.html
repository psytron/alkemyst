<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Catalog</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: white;
            min-height: 100vh;
            position: relative;
        }
        
        /* Background image strip */
        .background-strip {
            position: relative;
            height: 300px;
            width: 100vw;
            left: 50%;
            right: 50%;
            margin-left: -50vw;
            margin-right: -50vw;
            background-image: url('https://images.unsplash.com/photo-1464983953574-0892a716854b?auto=format&fit=crop&w=1500&q=80'); /* minimalist space/zodiac */
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            margin-bottom: 2rem;
            margin-top: 0;
            z-index: 0;
        }
        
        .navbar {
            background: linear-gradient(135deg, #0a2342 0%, #1a1a40 100%);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: relative;
            z-index: 1000;
            padding: 1rem 0;
        }
        
        .navbar-brand {
            color: white !important;
            font-weight: bold;
        }
        
        .nav-link {
            color: rgba(255,255,255,0.9) !important;
        }
        
        .nav-link:hover {
            color: white !important;
        }
        
        .navbar-text {
            color: white !important;
        }
        
        .main-container {
            padding-top: 0;
            /* Remove extra space above hero */
            padding-bottom: 2rem;
            position: relative;
            z-index: 1;
        }
        
        .product-card {
            background: none;
            /* border-radius: 15px; */
            /* box-shadow: 0 5px 15px rgba(0,0,0,0.1); */
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: none;
            overflow: hidden;
            height: 100%;
            display: flex;
            flex-direction: column;
            padding: 0;
            margin: 0;
        }
        
        .product-card:hover {
            /* transform: translateY(-5px); */
            /* box-shadow: 0 10px 25px rgba(0,0,0,0.15); */
        }
        
        .product-image {
            width: 100%;
            height: 200px;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            border-radius: 24px;
            overflow: hidden;
            position: relative;
        }
        
        .product-info {
            padding: 1rem 1.5rem;
            display: flex;
            flex-direction: column;
            flex-grow: 1;
        }
        
        .product-title {
            font-weight: bold;
            color: #333;
            margin-bottom: 0.5rem;
        }
        
        .product-description {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 1rem;
            line-height: 1.4;
            flex-grow: 1;
        }
        
        .product-price {
            font-size: 1.25rem;
            font-weight: bold;
            color: #667eea;
        }
        
        .product-sku {
            font-size: 0.8rem;
            color: #999;
            margin-bottom: 0.5rem;
        }
        
        .product-actions {
            margin-top: auto;
        }
        
        .category-filter {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }
        
        .category-nav {
            padding: 0;
            margin-bottom: 0;
            overflow-x: auto;
            margin-top: 0;
        }
        
        .category-nav .nav {
            flex-wrap: nowrap;
            gap: 0.25rem;
            justify-content: center;
        }
        
        .category-nav .nav-link {
            background: transparent;
            color: rgba(255,255,255,0.9);
            border: 2px solid transparent;
            border-radius: 20px;
            padding: 0.5rem 1rem;
            font-weight: 500;
            white-space: nowrap;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }
        
        .category-nav .nav-link:hover {
            background: rgba(255,255,255,0.2);
            color: white;
            border-color: rgba(255,255,255,0.3);
        }
        
        .category-nav .nav-link.active {
            background: rgba(255,255,255,0.3);
            color: white;
            border-color: rgba(255,255,255,0.5);
        }
        
        .category-nav .nav-link i {
            margin-right: 0.5rem;
        }
        
        .loading {
            text-align: center;
            padding: 3rem;
            color: #666;
        }
        
        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 1rem;
            border-radius: 10px;
            margin: 1rem 0;
        }
        
        .welcome-section {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
            text-align: center;
        }
        
        .welcome-section h2 {
            color: #667eea;
            margin-bottom: 1rem;
        }
        
        .btn-logout {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            border: none;
            border-radius: 25px;
            padding: 8px 20px;
            color: white;
            font-weight: 600;
        }
        
        .btn-logout:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            color: white;
        }
        
        .cart-icon .btn-link {
            text-decoration: none;
            padding: 0.5rem;
        }
        
        .cart-icon .btn-link:hover {
            transform: scale(1.1);
        }
        
        .cart-badge {
            font-size: 0.75rem;
            min-width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .add-to-cart-btn {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            border: none;
            border-radius: 25px;
            padding: 0.5rem 1rem;
            color: white;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .add-to-cart-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            color: white;
        }
        
        .add-to-cart-btn:disabled {
            background: #6c757d;
            transform: none;
            box-shadow: none;
        }
        
        .cart-modal .modal-content {
            border-radius: 15px;
            border: none;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        .cart-item {
            border-bottom: 1px solid #e9ecef;
            padding: 1rem 0;
        }
        
        .cart-item:last-child {
            border-bottom: none;
        }
        
        .cart-item-image {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
        }
        
        .cart-total {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 1rem;
            margin-top: 1rem;
        }
        
        .logout-icon .btn-link {
            text-decoration: none;
            padding: 0.5rem;
        }
        .logout-icon .btn-link:hover {
            transform: scale(1.1);
            color: #ff6b6b !important;
        }
        
        /* Add new category bar styles */
        .category-bar {
            background: #111;
            min-height: 38px;
            display: flex;
            align-items: center;
            padding: 0 0.5rem;
            border-bottom: 1px solid #222;
            margin-bottom: 0;
            margin-top: 0;
        }
        .category-bar .nav {
            width: 100%;
            gap: 0.25rem;
        }
        .category-bar .nav-link {
            color: #fff !important;
            font-size: 0.92rem;
            padding: 0.25rem 0.9rem;
            border-radius: 16px;
            background: transparent;
            border: none;
            transition: background 0.2s, color 0.2s;
        }
        .category-bar .nav-link.active, .category-bar .nav-link:hover {
            background: #222;
            color: #00e6ff !important;
        }
        .category-bar form {
            margin-left: 1rem;
        }
        .category-bar input[type="search"] {
            background: #222;
            color: #fff;
            border: none;
            font-size: 0.92rem;
            padding: 0.25rem 0.9rem;
            border-radius: 16px;
            width: 120px;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg">
        <div class="container">
            <a class="navbar-brand" href="#">
                <span style="font-family: 'Orbitron', 'Audiowide', 'Exo', 'Segoe UI', Arial, sans-serif; font-weight: bold;">
                    <i class="fas fa-rocket me-2" style="color: #00e6ff;"></i>A7T
                </span>
                
            </a>
            
            <!-- Category Navigation -->
            <div class="category-nav">
                <nav class="nav" id="categoryNav">
                    <a class="nav-link active" href="#" data-category-id="">
                        <i class="fas fa-th-large"></i>All Categories
                    </a>
                    <!-- Categories will be loaded here -->
                </nav>
            </div>
            
            <div class="navbar-nav ms-auto">
                <form class="d-flex me-3" role="search" onsubmit="return false;">
                    <input class="form-control me-2" type="search" placeholder="Search products..." aria-label="Search" id="productSearchInput" autocomplete="off" style="min-width: 220px;">
                </form>
                <span class="navbar-text me-3" id="userInfo">
                    <span id="username">User</span>!
                </span>
                <div class="cart-icon me-3">
                    <button class="btn btn-link text-white position-relative" onclick="showCart()">
                        <i class="fas fa-shopping-cart fa-lg"></i>
                        <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" id="cartBadge">
                            0
                        </span>
                    </button>
                </div>
                <div class="logout-icon">
                    <button class="btn btn-link text-white" onclick="logout()" title="Logout">
                        <i class="fas fa-sign-out-alt fa-lg"></i>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Category Navigation Bar -->
    <div class="category-bar">
        <nav class="nav justify-content-center align-items-center" id="categoryNav">
            <a class="nav-link active" href="#" data-category-id="">
                <i class="fas fa-th-large"></i>All Categories
            </a>
            <!-- Categories and search will be loaded here -->
        </nav>
    </div>

    <div class="container main-container">
        <!-- Background Image Strip -->
        <div class="background-strip"> </div>
        
        <!-- Welcome Section -->
        <!-- Category Filter -->


        <!-- Loading State -->
        <div id="loadingState" class="loading">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-3">Loading products...</p>
        </div>

        <!-- Error State -->
        <div id="errorState" class="error-message" style="display: none;">
            <i class="fas fa-exclamation-triangle me-2"></i>
            <span id="errorText">An error occurred while loading products.</span>
        </div>

        <!-- Products Grid -->
        <div id="productsGrid" style="display: none;">
            
            <div class="row" id="productsContainer">
                <!-- Products will be loaded here -->
            </div>
        </div>


        <div class="category-filter">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <h5 class="mb-0"><i class="fas fa-filter me-2"></i>Filter by Category</h5>
                </div>
                <div class="col-md-6">
                    <select class="form-select" id="categoryFilter">
                        <option value="">All Categories</option>
                    </select>
                </div>
            </div>
        </div>
        
        
    </div>

    <!-- Shopping Cart Modal -->
    <div class="modal fade cart-modal" id="cartModal" tabindex="-1" aria-labelledby="cartModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="cartModalLabel">
                        <i class="fas fa-shopping-cart me-2"></i>Shopping Cart
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="cartItems">
                        <!-- Cart items will be loaded here -->
                    </div>
                    <div class="cart-total" id="cartTotal" style="display: none;">
                        <div class="d-flex justify-content-between align-items-center">
                            <h6 class="mb-0">Total:</h6>
                            <h5 class="mb-0 text-primary" id="cartTotalAmount">$0.00</h5>
                        </div>
                    </div>
                    <div id="emptyCart" class="text-center py-4">
                        <i class="fas fa-shopping-cart fa-3x text-muted mb-3"></i>
                        <h5 class="text-muted">Your cart is empty</h5>
                        <p class="text-muted">Add some products to get started!</p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Continue Shopping</button>
                    <a href="/static/checkout.html" class="btn btn-primary" id="checkoutBtn">
                        <i class="fas fa-credit-card me-2"></i>Checkout
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="js/bootstrap.bundle.min.js"></script>
    
    <script>
        // API Base URL
        let API_BASE = '/api';
        if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
            API_BASE = 'http://localhost:8000';
        }
        
        // Cart functionality
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        let allProductsCache = [];
        let currentCategoryId = null;

        document.addEventListener('DOMContentLoaded', function() {
            checkAuth();
            updateCartBadge();
            // Search input event
            const searchInput = document.getElementById('productSearchInput');
            if (searchInput) {
                searchInput.addEventListener('input', function() {
                    performProductSearch();
                });
            }
        });
        
        function checkAuth() {
            const token = localStorage.getItem('access_token');
            if (!token) {
                // THIS REDIRECTS TO ROOT IF NO TOKEN: 
                //window.location.href = '/';
                return;
            }
            
            // Decode token to get username
            try {
                const payload = JSON.parse(atob(token.split('.')[1]));
                document.getElementById('username').textContent = payload.username || 'User';
            } catch (e) {
                console.error('Error decoding token:', e);
            }
            
            // Load categories and products
            loadCategories();
            loadProducts();
        }
        
        async function loadCategories() {
            try {
                const response = await fetch(`${API_BASE}/categories`, {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('access_token')}`
                    }
                });
                
                if( !response.ok ) {
                    throw new Error(' Failed to load categories ');
                }
                const categories = await response.json();
                displayCategories( categories );
                populateCategoryFilter( categories );

            } catch (error) {
                console.error('Error loading categories:', error);
                showError('Failed to load categories. Please try again.');
            }
        }
        
        async function loadProducts(categoryId = null) {
            try {
                showLoading(true);
                
                let url;
                if (categoryId) {
                    url = `${API_BASE}/products/${categoryId}`;
                } else {
                    url = `${API_BASE}/products`;
                }
                
                console.log('Loading products from:', url);
                console.log('Category ID:', categoryId);
                
                const response = await fetch(url, {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('access_token')}`
                    }
                });
                
                console.log('Response status:', response.status);
                
                if (!response.ok) {
                    throw new Error(`Failed to load products: ${response.status} ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('Response data:', data);
                
                // Handle both single category response and all products response
                let products = data.products || data;
                
                // If no category is selected, limit to first 10 products
                if (!categoryId && Array.isArray(products)) {
                    products = products.slice(0, 10);
                }
                
                console.log('Final products to display:', products);
                allProductsCache = products; // Cache for search
                displayProducts(products);
                
            } catch (error) {
                console.error('Error loading products:', error);
                showError('Failed to load products. Please try again.');
            } finally {
                showLoading(false);
            }
        }

        function performProductSearch() {
            const searchInput = document.getElementById('productSearchInput');
            const searchTerm = searchInput ? searchInput.value.trim().toLowerCase() : '';
            let filtered = allProductsCache;
            if (searchTerm) {
                filtered = allProductsCache.filter(product =>
                    (product.name && product.name.toLowerCase().includes(searchTerm)) ||
                    (product.description && product.description.toLowerCase().includes(searchTerm))
                );
            }
            displayProducts(filtered);
        }
        
        function displayCategories(categories) {
            const container = document.getElementById('categoryNav');
            const allCategoriesLink = container.querySelector('[data-category-id=""]');
            // Clear existing category links (except "All Categories")
            const existingLinks = container.querySelectorAll('[data-category-id]:not([data-category-id=""])');
            existingLinks.forEach(link => link.remove());

            // Always include all main categories
            const allMainCategories = [
                { id: 'electronics', name: 'Electronics' },
                { id: 'linens', name: 'Linens' },
                { id: 'plants', name: 'Plants' },
                { id: 'courses', name: 'Courses' },
                { id: 'kits', name: 'Kits' }
            ];
            
            // Add these categories if not already in the API response
            allMainCategories.forEach(mainCat => {
                if (!categories.some(cat => cat.name.toLowerCase() === mainCat.name.toLowerCase())) {
                    categories.push(mainCat);
                }
            });

            // Show all categories as individual links in both nav areas
            categories.forEach(category => {
                // Add to main navbar
                const categoryLink = document.createElement('a');
                categoryLink.className = 'nav-link';
                categoryLink.href = '#';
                categoryLink.setAttribute('data-category-id', category.id);
                categoryLink.innerHTML = `<i class="fas fa-tag"></i>${category.name}`;
                categoryLink.addEventListener('click', function(e) {
                    e.preventDefault();
                    container.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
                    this.classList.add('active');
                    loadProducts(category.id);
                    document.getElementById('categoryFilter').value = category.id;
                });
                container.appendChild(categoryLink);
                
                // Also add to black category bar
                const blackBarContainer = document.querySelector('.category-bar .nav');
                const blackBarLink = document.createElement('a');
                blackBarLink.className = 'nav-link';
                blackBarLink.href = '#';
                blackBarLink.setAttribute('data-category-id', category.id);
                blackBarLink.innerHTML = `<i class="fas fa-tag"></i>${category.name}`;
                blackBarLink.addEventListener('click', function(e) {
                    e.preventDefault();
                    blackBarContainer.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
                    this.classList.add('active');
                    loadProducts(category.id);
                    document.getElementById('categoryFilter').value = category.id;
                });
                blackBarContainer.appendChild(blackBarLink);
            });
        }
        
        function displayProducts(products) {
            const container = document.getElementById('productsContainer');
            container.innerHTML = '';
            
            if (products.length === 0) {
                container.innerHTML = `
                    <div class="col-12 text-center">
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            No products found in this category.
                        </div>
                    </div>
                `;
            } else {
                products.forEach(product => {
                    const productImage = product.image
                      ? `<img src="${product.image}" alt="${product.name}" class="img-fluid rounded" style="width: 64px; height: 64px; object-fit: cover;">`
                      : `<div class='d-flex align-items-center justify-content-center bg-light rounded' style='width:64px;height:64px;'><i class="fas fa-box fa-2x text-secondary"></i></div>`;
                    const productRow = `
                        <div class="col-12">
                            <div class="d-flex align-items-center border-bottom py-3 gap-3">
                                <div style="min-width: 70px;">${productImage}</div>
                                <div class="flex-grow-1">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <h5 class="mb-1 product-title">${product.name}</h5>
                                        <span class="product-price">$${(product.price / 100).toFixed(2)}</span>
                                    </div>
                                    <div class="text-muted small mb-1">SKU: ${product.sku}</div>
                                    <div class="product-description mb-1">${product.description || 'No description available'}</div>
                                    <div class="d-flex align-items-center gap-2">
                                        ${product.stock_quantity > 0 ? 
                                            `<small class="text-success"><i class="fas fa-check-circle me-1"></i>In Stock (${product.stock_quantity})</small>` : 
                                            `<small class="text-danger"><i class="fas fa-times-circle me-1"></i>Out of Stock</small>`
                                        }
                                        ${product.sale_price ? `<span class="text-danger ms-2"><small><s>$${(product.sale_price / 100).toFixed(2)}</s></small></span>` : ''}
                                    </div>
                                </div>
                                <div style="min-width: 160px;">
                                    <button class="btn add-to-cart-btn w-100" onclick="addToCart(${product.id}, '${product.name.replace(/'/g, "&#39;")}', ${product.price}, '${product.sku}')" ${product.stock_quantity <= 0 ? 'disabled' : ''}>
                                        <i class="fas fa-cart-plus me-2"></i>Add to Cart
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                    container.innerHTML += productRow;
                });
            }
            
            document.getElementById('productsGrid').style.display = 'block';
        }
        
        function populateCategoryFilter(categories) {
            const filter = document.getElementById('categoryFilter');
            // Clear existing options except "All Categories"
            const existingOptions = filter.querySelectorAll('option:not([value=""])');
            existingOptions.forEach(option => option.remove());
            
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category.id;
                option.textContent = category.name;
                filter.appendChild(option);
            });
        }
        
        // Category filter change handler
        document.getElementById('categoryFilter').addEventListener('change', function() {
            const categoryId = this.value;
            
            // Update navigation active state
            const navLinks = document.querySelectorAll('#categoryNav .nav-link');
            navLinks.forEach(link => link.classList.remove('active'));
            
            if (categoryId) {
                const activeLink = document.querySelector(`#categoryNav [data-category-id="${categoryId}"]`);
                if (activeLink) {
                    activeLink.classList.add('active');
                }
                loadProducts(categoryId);
            } else {
                // Select "All Categories" link
                const allCategoriesLink = document.querySelector('#categoryNav [data-category-id=""]');
                if (allCategoriesLink) {
                    allCategoriesLink.classList.add('active');
                }
                loadProducts();
            }
        });
        
        // Add click handler for "All Categories" link
        document.addEventListener('DOMContentLoaded', function() {
            const allCategoriesLink = document.querySelector('#categoryNav [data-category-id=""]');
            if (allCategoriesLink) {
                allCategoriesLink.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Remove active class from all links
                    document.querySelectorAll('#categoryNav .nav-link').forEach(link => {
                        link.classList.remove('active');
                    });
                    
                    // Add active class to "All Categories" link
                    this.classList.add('active');
                    
                    // Reset dropdown filter
                    document.getElementById('categoryFilter').value = '';
                    
                    // Load all products
                    loadProducts();
                });
            }
        });
        
        function showLoading(show) {
            const loadingState = document.getElementById('loadingState');
            const errorState = document.getElementById('errorState');
            
            if (show) {
                loadingState.style.display = 'block';
                errorState.style.display = 'none';
                document.getElementById('productsGrid').style.display = 'none';
            } else {
                loadingState.style.display = 'none';
            }
        }
        
        function showError(message) {
            const errorState = document.getElementById('errorState');
            const errorText = document.getElementById('errorText');
            
            errorText.textContent = message;
            errorState.style.display = 'block';
            document.getElementById('loadingState').style.display = 'none';
        }
        
        function logout() {
            localStorage.removeItem('access_token');
            localStorage.removeItem('refresh_token');
            window.location.href = '/';
        }
        
        function addToCart(productId, productName, price, sku) {
            // Check if product is already in cart
            const existingItem = cart.find(item => item.id === productId);
            
            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                cart.push({
                    id: productId,
                    name: productName,
                    price: price,
                    sku: sku,
                    quantity: 1
                });
            }
            
            // Save to localStorage
            localStorage.setItem('cart', JSON.stringify(cart));
            
            // Update cart badge
            updateCartBadge();
            
            // Show success message
            showCartNotification('Product added to cart!');
        }
        
        function removeFromCart(productId) {
            cart = cart.filter(item => item.id !== productId);
            localStorage.setItem('cart', JSON.stringify(cart));
            updateCartBadge();
            showCart();
        }
        
        function updateQuantity(productId, newQuantity) {
            const item = cart.find(item => item.id === productId);
            if (item) {
                if (newQuantity <= 0) {
                    removeFromCart(productId);
                } else {
                    item.quantity = newQuantity;
                    localStorage.setItem('cart', JSON.stringify(cart));
                    updateCartBadge();
                    showCart();
                }
            }
        }
        
        function updateCartBadge() {
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            const badge = document.getElementById('cartBadge');
            badge.textContent = totalItems;
            
            // Hide badge if cart is empty
            if (totalItems === 0) {
                badge.style.display = 'none';
            } else {
                badge.style.display = 'flex';
            }
        }
        
        function showCart() {
            const cartItems = document.getElementById('cartItems');
            const cartTotal = document.getElementById('cartTotal');
            const emptyCart = document.getElementById('emptyCart');
            
            if (cart.length === 0) {
                cartItems.innerHTML = '';
                cartTotal.style.display = 'none';
                emptyCart.style.display = 'block';
            } else {
                emptyCart.style.display = 'none';
                cartTotal.style.display = 'block';
                
                let total = 0;
                cartItems.innerHTML = '';
                
                cart.forEach(item => {
                    const itemTotal = item.price * item.quantity;
                    total += itemTotal;
                    
                    const cartItem = `
                        <div class="cart-item">
                            <div class="row align-items-center">
                                <div class="col-2">
                                    <div class="cart-item-image">
                                        <i class="fas fa-box"></i>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <h6 class="mb-1">${item.name}</h6>
                                    <small class="text-muted">SKU: ${item.sku}</small>
                                    <div class="mt-2">
                                        <span class="text-primary fw-bold">$${(item.price / 100).toFixed(2)}</span>
                                    </div>
                                </div>
                                <div class="col-2">
                                    <div class="input-group input-group-sm">
                                        <button class="btn btn-outline-secondary" type="button" onclick="updateQuantity(${item.id}, ${item.quantity - 1})">-</button>
                                        <input type="text" class="form-control text-center" value="${item.quantity}" readonly>
                                        <button class="btn btn-outline-secondary" type="button" onclick="updateQuantity(${item.id}, ${item.quantity + 1})">+</button>
                                    </div>
                                </div>
                                <div class="col-2 text-end">
                                    <button class="btn btn-sm btn-outline-danger" onclick="removeFromCart(${item.id})">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                    cartItems.innerHTML += cartItem;
                });
                
                document.getElementById('cartTotalAmount').textContent = `$${(total / 100).toFixed(2)}`;
            }
            
            // Show the modal
            const modal = new bootstrap.Modal(document.getElementById('cartModal'));
            modal.show();
        }
        
        function showCartNotification(message) {
            // Create a temporary notification
            const notification = document.createElement('div');
            notification.className = 'alert alert-success position-fixed';
            notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
            notification.innerHTML = `
                <i class="fas fa-check-circle me-2"></i>${message}
            `;
            
            document.body.appendChild(notification);
            
            // Remove after 3 seconds
            setTimeout(() => {
                notification.remove();
            }, 1000);
        }
    </script>
</body>
</html>
